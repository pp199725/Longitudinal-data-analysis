rep(ybar0,10)
data$ybar <- c(rep(ybar0,10), rep(ybar10,10), rep(ybar20, 10), rep(ybar30, 10),
rep(ybar40, 10), rep(ybar50, 10))
tail(data)
head(data)
(cor(data$yobs, data$ybar))^2
summary(m9)
m9$fitted.values[10]
m9$fitted.values[1:10]
mean(m9$fitted.values[1:10])
sigma=200
set.seed(0)
error <- rnorm(n,0, sigma)
yobs <- b + b1*x + error
m9 <- lm(yobs ~ x)
summary(m9)
sigma=300
set.seed(0)
error <- rnorm(n,0, sigma)
yobs <- b + b1*x + error
summary(yobs)
m9 <- lm(yobs ~ x)
summary(m9)
(cor(yobs, x))^2 # it's equal
data <- data.frame(cbind(yobs, x))
ybar0 <- mean(data[data$x==0,1])
ybar10 <- mean(data[data$x==10,1])
ybar20 <- mean(data[data$x==20,1])
ybar30 <- mean(data[data$x==30,1])
ybar40 <- mean(data[data$x==40,1])
ybar50 <- mean(data[data$x==50,1])
data$ybar <- c(rep(ybar0,10), rep(ybar10,10), rep(ybar20, 10), rep(ybar30, 10),
rep(ybar40, 10), rep(ybar50, 10))
(cor(data$yobs, data$ybar))^2
(cor(data$x, data$ybar))^2
cor(data$x, data$ybar)
x <- runif(n, 0,30)
x
sigma=10
set.seed(0)
error <- rnorm(n,0, sigma)
yobs <- b + b1*x + error
summary(yobs)
plot(density(yobs))
m9 <- lm(yobs ~ x)
summary(m9)
plot(x, yobs)
plot(density(yobs))
plot(density(x))
plot(x, yobs)
b1 <- 5
yobs <- b + b1*x + error
m9 <- lm(yobs ~ x)
summary(m9)
plot(x, yobs)
b1 <- 1
s
yobs <- b + b1*x + error
m9 <- lm(yobs ~ x)
summary(m9)
b <- 0
yobs <- b + b1*x + error
m9 <- lm(yobs ~ x)
plot(x, yobs)
sigma=1
set.seed(0)
error <- rnorm(n,0, sigma)
yobs <- b + b1*x + error
m9 <- lm(yobs ~ x)
summary(m9)
plot(x, yobs)
b <- 10
b1 <- 0
sigma=1
set.seed(0)
error <- rnorm(n,0, sigma)
yobs <- b + b1*x + error
m9 <- lm(yobs ~ x)
summary(m9)
sigma=0
error <- rnorm(n,0, sigma)
yobs <- b + b1*x + error
m9 <- lm(yobs ~ x)
summary(m9)
plot(x, yobs)
abline(m9)
x <- rnorm(100, 10, 0)
plot(density(x))
yobs <- b + b1*x + error
lwngth(x)
length(x)
length(error)
n=100
error <- rnorm(n,0, sigma)
yobs <- b + b1*x + error
summary(yobs)
plot(density(yobs))
m9 <- lm(yobs ~ x)
summary(m9)
anova(m9)
sigma=10
set.seed(0)
error <- rnorm(n,0, sigma)
yobs <- b + b1*x + error
m9 <- lm(yobs ~ x)
summary(m9)
b1 <- 0.1
yobs <- b + b1*x + error
m9 <- lm(yobs ~ x)
summary(m9)
b1 <- 1
yobs <- b + b1*x + error
m9 <- lm(yobs ~ x)
summary(m9)
plot(x, yobs)
x <- rnorm(100, 10, 10)
set.seed(0)
x <- rnorm(100, 10, 10)
yobs <- b + b1*x + error
plot(x, yobs)
b1 <- 0
yobs <- b + b1*x + error
plot(x, yobs)
b1 <- 0
yobs <- b + b1*x + error
plot(x, yobs)
b1
sigma=100
set.seed(0)
error <- rnorm(n,0, sigma)
yobs <- b + b1*x + error
plot(x, yobs)
b1 <- -10
yobs <- b + b1*x + error
plot(x, yobs)
b1 <- 10
yobs <- b + b1*x + error
m9 <- lm(yobs ~ x)
summary(m9)
plot(x, yobs)
abline(m9)
plot(x, yobs)
par(mfrow=c(1,1))
plot(x, yobs)
sigma=10
set.seed(0)
error <- rnorm(n,0, sigma)
yobs <- b + b1*x + error
m9 <- lm(yobs ~ x)
summary(m9)
plot(x, yobs)
yobs
x
summary(error)
b1 <- 0
sigma=100
n=60
set.seed(0)
x <- c(rep(0,10), rep(10,10), rep(20, 10), rep(30, 10), rep(40, 10), rep(50, 10))
plot(density(x))
#True regression parameters
b <- 20
b1 <- 0
sigma=100
set.seed(0)
error <- rnorm(n,0, sigma)
yobs <- b + b1*x + error
m9 <- lm(yobs ~ x)
summary(m9)
sigma=10
set.seed(0)
error <- rnorm(n,0, sigma)
yobs <- b + b1*x + error
m9 <- lm(yobs ~ x)
summary(m9)
sigma=1
set.seed(0)
error <- rnorm(n,0, sigma)
yobs <- b + b1*x + error
summary(yobs)
m9 <- lm(yobs ~ x)
summary(m9)
n=100
set.seed(0)
x <- rnorm(100, 10, 10)
plot(density(x))
#True regression parameters
b <- 10
b1 <- 0
sigma=10
set.seed(0)
error <- rnorm(n,0, sigma)
#Getting the observed values of y
yobs <- b + b1*x + error
#checking it out
summary(yobs)
sigma=1
set.seed(0)
error <- rnorm(n,0, sigma)
yobs <- b + b1*x + error
summary(yobs)
summary(x)
b <- 1
yobs <- b + b1*x + error
summary(yobs)
m9 <- lm(yobs ~ x)
summary(m9)
plot(x, yobs)
abline(m9)
b1*x
b
1+error
sigma=0.1
set.seed(0)
error <- rnorm(n,0, sigma)
yobs <- b + b1*x + error
yobs
m9 <- lm(yobs ~ x)
summary(m9)
plot(x, yobs)
set.seed(10)
x <- rnorm(100, 10, 10)
yobs <- b + b1*x + error
m9 <- lm(yobs ~ x)
summary(m9)
plot(x, yobs)
b <- 10
yobs <- b + b1*x + error
m9 <- lm(yobs ~ x)
summary(m9)
x <- rnorm(100, 10, 0.1)
yobs <- b + b1*x + error
m9 <- lm(yobs ~ x)
summary(m9)
plot(x, yobs)
x <- rnorm(100, 10, 0.0001)
x <- rnorm(100, 10, 0.1)
b1 <- 0.01
yobs <- b + b*x + error
summary(yobs)
summary(x)
summary(error)
yobs <- b + b*x + error
summary(yobs)
b
b*x
summary(b)
summary(x)
yobs <- b + b1*x + error
summary(yobs)
m9 <- lm(yobs ~ x)
summary(m9)
plot(x, yobs)
abline(m9)
sigma=0.01
set.seed(0)
error <- rnorm(n,0, sigma)
yobs <- b + b1*x + error
m9 <- lm(yobs ~ x)
summary(m9)
plot(x, yobs)
abline(m9)
sigma=0.00001
set.seed(0)
yobs <- b + b1*x + error
m9 <- lm(yobs ~ x)
summary(m9)
plot(x, yobs)
abline(m9)
b1 <- 0.1
yobs <- b + b1*x + error
m9 <- lm(yobs ~ x)
summary(m9)
plot(x, yobs)
abline(m9)
yobs <- b
m9 <- lm(yobs ~ x)
yobs <- rep(b,100)
m9 <- lm(yobs ~ x)
summary(m9)
x <- rep(10, 100)
m9 <- lm(yobs ~ x)
summary(m9)
yobs <- rep(b,100)+ b1*x + error
m9 <- lm(yobs ~ x)
summary(m9)
cor(x,yobs)
summary(yobs)
summary(x)
sigma=0.001
set.seed(0)
error <- rnorm(n,0, sigma)
yobs <- rep(b,100)+ b1*x + error
cor(x,yobs)
summary(yobs)
summary(x)
x <- rnorm(100, 10, 0.5)
yobs <- rep(b,100)+ b1*x + error
cor(yobs,x)
summary(yobs)
summary(x)
m9 <- lm(yobs ~ x)
summary(m9)
plot(x, yobs)
abline(m9)
b1 <- 0.001
yobs <- rep(b,100)+ b1*x + error
m9 <- lm(yobs ~ x)
summary(m9)
sigma=0.1
set.seed(0)
error <- rnorm(n,0, sigma)
yobs <- rep(b,100)+ b1*x + error
m9 <- lm(yobs ~ x)
summary(m9)
set.seed(10)
x <- rnorm(100, 10, 0.5)
plot(density(x))
#True regression parameters
b <- 10
b1 <- 0.01
sigma=0.001
set.seed(0)
error <- rnorm(n,0, sigma)
#Getting the observed values of y
yobs <- rep(b,100)+ b1*x + error
#checking it out
summary(yobs)
plot(density(yobs))
# Fitting a regression model to estimate regression coefficients and fitted values of y
m9 <- lm(yobs ~ x)
summary(m9)
plot(x, yobs)
abline(m9)
yobs <- rep(b,100)+ b1*x
m9 <- lm(yobs ~ x)
summary(m9)
plot(x, yobs)
abline(m9)
error <- 0
yobs <- rep(b,100)+ b1*x + error
m9 <- lm(yobs ~ x)
summary(m9)
plot(x, yobs)
abline(m9)
yobs <- b+ b1*x + error
m9 <- lm(yobs ~ x)
summary(m9)
plot(x, yobs)
abline(m9)
error
setwd("C:/Users/tyatabe/OneDrive/Docs/PhD Epi/Spring 2016/EPI 226/HW/HW4")
tlc <- read.table("tlc-data.txt")
colnames(tlc) <- c("ID", "group","Base", "wk1", "wk4", "wk6")
d <- reshape(tlc, varying=c("Base", "wk1", "wk4", "wk6"), direction="long", v.names="lead",
idvar="ID")
d <- d[order(d$ID),]
#Checking it out
row.names(d) <- NULL
d[1:20,]
str(d)
d$week <- d$time
d$week[d$time==1] <- 0
d$week[d$time==2] <- 1
d$week[d$time==3] <- 4
d$week[d$time==4] <- 6
d$week <- factor(d$week, c(0,1,4,6))
summary(d)
d<- within(d, group <- relevel(group, ref = 2))
library(nlme)
m1 <- gls(lead~ group*week, data=d, correlation= corSymm(form = ~ time | ID),
weights = varIdent(form = ~ 1 | time), method="REML")
summary(m1)
m2 <- gls(lead~ I(week==1) + I(week==4) + I(week==6) + I(week==1 & group=="A") +
I(week==4 & group=="A") + I(week==6 & group=="A"),
data=d, correlation= corSymm(form = ~ time | ID),
weights = varIdent(form = ~ 1 | time), method="REML")
anova(m2)
summary(m2)
tlc$baseline <- tlc$Base
d2 <- reshape(tlc, varying=c("Base", "wk1", "wk4", "wk6"), direction="long", v.names="lead",
idvar="ID")
d2 <- d2[order(d2$ID),]
#Checking it out
row.names(d2) <- NULL
d2[1:20,]
str(d2)
# Subsetting to remove baseline obs
d2 <- subset(d2, time > 1)
d2$week <- d2$time
d2$week[d2$time==2] <- 1
d2$week[d2$time==3] <- 4
d2$week[d2$time==4] <- 6
d2$week <- factor(d2$week, c(1,4,6))
summary(d2)
# Changing the ref level for group to be "P"
d2<- within(d2, group <- relevel(group, ref = 2))
d2$time <- d2$time - 1
d2$D <- d2$lead-d2$baseline
m3 <- gls(D ~ group*week, data=d2, correlation= corSymm(form = ~ time | ID),
weights = varIdent(form = ~ 1 | time), method="REML")
anova(m3)
summary(m3)
d2$cbaseline <- d2$baseline - mean(d2$baseline)
m4 <- gls(D ~ cbaseline + group*week, data=d2, correlation= corSymm(form = ~ time | ID),
weights = varIdent(form = ~ 1 | time), method="REML")
anova(m4)
summary(m4)
m4 <- gls(D ~ cbaseline + group*week, data=d2, correlation= corSymm(form = ~ time | ID),
weights = varIdent(form = ~ 1 | time), method="ML")
m5 <- gls(D ~ cbaseline + week, data=d2, correlation= corSymm(form = ~ time | ID),
weights = varIdent(form = ~ 1 | time), method="ML")
anova(m4, m5)
?anova
anova(m4, m5, test="Wald")
anova(m4, m5, test=T)
waldtest(m4, m5)
library(lmtest)
install.packages("lmtest")
library(lmtest)
waldtest(m4, m5)
smoke <- read.table("smoking-data.txt")
str(smoke)
head(smoke)
colnames(smoke) <- c("ID", "smoker","time", "fev1")
head(smoke)
str(smoke)
summary(smoke)
m6 <- gls(fev1 ~ smoker*time, data=smoke, correlation= corSymm(form = ~ time | ID),
weights = varIdent(form = ~ 1 | time), method="REML")
colnames(smoke) <- c("ID", "smoker","year", "fev1")
head(smoke)
smoke$year <- smoke$time
smoke$year[time==0] <- 1
smoke$year[time==3] <- 2
smoke$year[time==6] <- 3
smoke$year[time==9] <- 4
smoke$year[time==12] <- 5
smoke$year[time==15] <- 6
smoke$year[time==19] <- 7
smoke$year <- smoke$time
smoke$year[smoke$time==0] <- 1
smoke$year[smoke$time==3] <- 2
smoke$year[smoke$time==6] <- 3
smoke$year[smoke$time==9] <- 4
smoke$year[smoke$time==12] <- 5
smoke$year[smoke$time==15] <- 6
smoke$year[smoke$time==19] <- 7
colnames(smoke) <- c("ID", "smoker","time", "fev1")
smoke <- read.table("smoking-data.txt")
#Tidying it up
colnames(smoke) <- c("ID", "smoker","time", "fev1")
# Checking it out
head(smoke)
smoke$year <- smoke$time
smoke$year[smoke$time==0] <- 1
smoke$year[smoke$time==3] <- 2
smoke$year[smoke$time==6] <- 3
smoke$year[smoke$time==9] <- 4
smoke$year[smoke$time==12] <- 5
smoke$year[smoke$time==15] <- 6
smoke$year[smoke$time==19] <- 7
head(smoke)
summary(smoke)
m6 <- gls(fev1 ~ smoker*time, data=smoke, correlation= corSymm(form = ~ year | ID),
weights = varIdent(form = ~ 1 | time), method="REML")
summary(m6)
m6 <- gls(fev1 ~ smoker*time, data=smoke, correlation= corSymm(form = ~ year | ID),
weights = varIdent(form = ~ 1 | year), method="REML")
anova(m6)
summary(m6)
m7 <- gls(fev1 ~ smoker*time + smoker*I(time^2), data=smoke, correlation= corSymm(form = ~ year | ID),
weights = varIdent(form = ~ 1 | year), method="ML")
summary(m7)
m6 <- gls(fev1 ~ smoker*time, data=smoke, correlation= corSymm(form = ~ year | ID),
weights = varIdent(form = ~ 1 | year), method="ML")
m7 <- gls(fev1 ~ smoker*time + smoker*timesqr, data=smoke, correlation= corSymm(form = ~ year | ID),
weights = varIdent(form = ~ 1 | year), method="ML")
summary(m7)
anova(m7, m6)
str(tlc)
str(d)
d$week <- d$time
d$week[d$time==1] <- 0
d$week[d$time==2] <- 1
d$week[d$time==3] <- 4
d$week[d$time==4] <- 6
str(d)
d$week1 <- (d$week-1)*I(d$week>=1)
str(d)
summary(d)
d$trt.week <- d$week*I(d$group=="A")
d$trt.week1 <- d$week1*I(d$group=="A")
I(d$week>=1)
d$week-1
d$week*I(d$group=="A")
d$week1*I(d$group=="A")
str(d)
m8 <- gls(lead ~ week + week1 + trt.week + trt.week1, data=d, corr=corSymm(, form= ~ time | ID),
weights = varIdent(form = ~ 1 | time))
summary(m8)
anova(m8, m7)
str(d)
m9 <- gls(lead ~ week*group + I(week^2)*group, data=d, corr=corSymm(, form= ~ time | ID),
weights = varIdent(form = ~ 1 | time))
summary(m9)
summary(m8)
m9 <- gls(lead ~ week + week:group + I(week^2) + I(week^2):group, data=d, corr=corSymm(, form= ~ time | ID),
weights = varIdent(form = ~ 1 | time))
summary(m9)
summary(m8)
anova(m8, m9)
